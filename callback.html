<!DOCTYPE html>
<html>
<head>
    <title>Connecting to Spotify...</title>
</head>
<body style="background:black;color:white;text-align:center;font-family:sans-serif;">
    <h2>Connecting your heartbeat to music ðŸŽ¶</h2>

<script>
const clientId = "a7f13b5dd0bc4822b1f911f9235914ec"; // from Spotify dashboard
const redirectUri = "https://daphnigeorge.github.io/valentine/callback.html";

// STEP 1 â€” Get code from URL
const params = new URLSearchParams(window.location.search);
const code = params.get("code");

if (!code) {
    document.body.innerHTML = "<h2>Authorization failed ðŸ˜¢</h2>";
}

// STEP 2 â€” Exchange code for token using PKCE
async function getToken() {

    const codeVerifier = localStorage.getItem("code_verifier");

    const response = await fetch("https://accounts.spotify.com/api/token", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: new URLSearchParams({
            client_id: clientId,
            grant_type: "authorization_code",
            code: code,
            redirect_uri: redirectUri,
            code_verifier: codeVerifier
        })
    });

    const data = await response.json();

    // Save token
    localStorage.setItem("spotify_access_token", data.access_token);

    // Send back to ECG page
    window.location.href = "ecg.html";
}

getToken();
</script>
</body>
</html>
